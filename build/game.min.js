/* EntityJS v0.4.2 entityjs.com | License entityjs.com/license */
function degreeToRadian(a){return a*(Math.PI/180)}function radianToDegree(a){return a*(180/Math.pi)}re=function(a){return new re.query(a)},re.version="0.4.2",re._e=[],re._c={},re.ready=function(a){re.listener("load",a)},re.$=function(a){return re.$._[a]=re.$._[a]||(a.charAt(0)=="#"?document.getElementById(a.substr(1)):document.getElementsByTagName(a)[0])},re.$._={},re.$new=function(a){return document.createElement(a)},re.listener=function(a,b,c){(c||window).addEventListener(a,b,!0)},re.is=function(a,b){return arguments.length==1?a!=null:a!=null&&Object.prototype.toString.call(a).slice(8,-1).toLowerCase()==b.toLowerCase()},re.comp=re.c=function(a){return re._c[a]||(re._c[a]=new re.c.init(a)),re._c[a]},re.c.init=function(a){this.name=a,this._re_listens={},this._re_defaults={},this._re_defines={},this._re_events={},this._re_final=0;if(!re[this.name]){var b=this;re[this.name]=function(){return b._re_method.apply(b,arguments)}}},re.c.init.prototype={z:function(a,b){return this._checkFinal(),this[a]||(this[a]=[]),re.is(b,"string")?this[a]=this[a].concat(b.split(" ")):this[a]=this[a].concat(b),this},_checkFinal:function(){if(this._re_final)throw this.name+" is final."},statics:function(a,b){this._checkFinal();if(!re.is(b))for(var c in a)re[this.name][c]=a[c];else re[this.name][a]=b;return this},events:function(a,b){this._checkFinal();if(!re.is(b))for(var c in a)this._re_events[c]=a[c];else this._re_events[a]=b;return this},factory:function(a){return this._checkFinal(),this._re_factory=a,this},_re_method:function(){var a=re.e(this.name);return this._re_factory&&this._re_factory.apply(a,arguments),a},method:function(a){return this._re_method=a,this},requires:function(a){return this.z("_re_requires",a)},asserts:function(a){return this.z("_re_asserts",a)},interfaces:function(a){return this.z("_re_interfaces",a)},alias:function(a){this._checkFinal();var b=a.split(" ");if(b.length>1){for(var c in b)this.alias(b[c]);return this}return a.charAt(0)=="-"?re._c[a.substr(1)]==this&&delete re._c[a.substr(1)]:re._c[a]=this,this},on:function(){return re.e.init.prototype.on.apply(this,arguments)},off:function(){return re.e.init.prototype.off.apply(this,arguments)},trigger:function(){return re.e.init.prototype.trigger.apply(this,arguments)},defaults:function(a,b){this._checkFinal();if(arguments.length==1)for(var c in a)this._re_defaults[c]=a[c];else this._re_defaults[a]=b;return this},namespaces:function(a,b){this._checkFinal();var c=this.name+"_";if(arguments.length==1)for(var d in a)this._re_defines[c+d]=a[d];else this._re_defines[c+a]=b;return this},defines:function(a,b){this._checkFinal();if(arguments.length==1)for(var c in a)this._re_defines[c]=a[c];else this._re_defines[a]=b;return this},init:function(a){return this._checkFinal(),this._re_init=a,this},dispose:function(a){return this._checkFinal(),this._re_dispose=a,this},lock:function(){return this._checkFinal(),this._re_final=1,this},run:function(a){return this._checkFinal(),a.call(this),this}},function(a){var b=function(b,c,d){if(!c){var e=new a.entity.init(b);return d||a._e.push(e),e}var f=a();for(var g=0;g<c;g++)f.push(a.e(b,0,d));return f},c=function(a){this._re_comps=[],this._re_listens={},this.comp(a)},d=c.prototype;d.comp=function(a){this._re_comp(a);if(this._re_interfaces)for(var b in this._re_interfaces)if(!this.hasOwnProperty(this._re_interfaces[b]))throw"Interface: "+this._re_interfaces[b]+" missing";if(this._re_asserts)for(var c in this._re_asserts)if(this._re_comps.indexOf(this._re_asserts[c])!=-1)throw"Assert: "+this._re_asserts[c]+" is not allowed";return this},d.removeComp=function(b){var c;a.is(b,"array")?c=b:c=b.split(" ");if(c.length>1){var d;while(d=c.shift())this.removeComp(d);return this}b=c[0];if(b&&this.has(b)){var e=a._c[b];e&&(e._re_dispose&&e._re_dispose.call(this,e),e.trigger("dispose",this)),this._re_comps.splice(this._re_comps.indexOf(b),1)}return this},d._re_comp=function(b){if(!b)return this;var c;a.is(b,"array")?c=b:c=b.split(" ");if(c.length>1){for(var d=0;d<c.length;d++)this._re_comp(c[d]);return this}b=c[0];if(!b)return this;var e,f=b.split(":");return b=f[0],f.shift(),e=a._c[b],this.has(b)||(this._re_comps.push(b),e&&(this._re_comp(e._re_requires),e._re_interfaces&&(this._re_interfaces||(this._re_interfaces=[]),this._re_interfaces=this._re_interfaces.concat(e._re_interfaces)),e._re_asserts&&(this._re_asserts||(this._re_asserts=[]),this._re_asserts=this._re_asserts.concat(e._re_asserts)),e._re_defaults&&this.def(e._re_defaults),e._re_defines&&this.attr(e._re_defines),e._re_events&&this.attr(e._re_events).on(e._re_events),e._re_init&&e._re_init.apply(this,f),e.trigger("init",this))),this},d.comps=function(){return this._re_comps.slice()},d.clone=function(b,c){return a.e(this._re_comps,b,c)},d._super=function(b,c){var d=Array.prototype.slice.call(arguments,2);if(b=="")return a.e.init.prototype[c].apply(this,d);var e=a._c[b];return e._re_defines[c]?e._re_defines[c].apply(this,d):e._re_defaults[c].apply(this,d)},d.has=function(b){a.is(b,"string")&&(b=a.query._toObj(b)),b.comp=b.comp||[],b.id=b.id||"",b.on=b.on||[],b.not=b.not||[];for(d=0;d<b.comp.length;d++)if(this._re_comps.indexOf(b.comp[d])==-1)return!1;for(d=0;d<b.not.length;d++)if(this._re_comps.indexOf(b.not[d])!=-1)return!1;var c;for(d=0;d<b.on.length;d++){c=b.on[d];if(!this._re_listens[c]||this._re_listens[c].length==0)return!1}return b.id!=""&&this.id!=b.id?!1:!0},d.on=function(b,c,d){if(a.is(b,"object"))for(var e in b)this.on(e,b[e],c);else{this._re_listens[b]||(this._re_listens[b]=[]);if(!a.is(c))throw"Method is null";this._re_listens[b].push({c:d||this,f:c})}return this},d.off=function(b,c){if(a.is(b,"object"))for(var d in b)b.hasOwnProperty(d)&&this.off(d,b[d]);else if(c){var e=this._re_listens[b];for(var d in e)e[d].f==c&&e.splice(d,1)}else b?this._re_listens[b]=[]:this._re_listens={};return this},d.trigger=function(a){if(!this._re_listens[a])return this;var b;for(var c=0,d=this._re_listens[a].length;c<d;c++){b=this._re_listens[a];if(!b)break;if(!b[c])continue;b[c].f.apply(b[c].c,Array.prototype.slice.call(arguments,1))===!1&&b.splice(c,1)}return this},d.attr=d.set=function(b,c){if(a.is(b,"object"))for(var d in b)this.attr(d,b[d]);else{var e="function";a.is(this[b],e)&&!a.is(c,e)?a.is(c,"array")?this[b].apply(this,c):this[b].call(this,c):this[b]=c}return this},d.get=function(b){return a.is(this[b],"function")?this[b]():this[b]},d.def=function(b,c){if(a.is(b,"object"))for(var d in b)this.def(d,b[d]);else a.is(this[b])||(this[b]=c);return this},d.dispose=function(){var b="dispose";return this.removeComp(this.comps()),this.trigger(b),this.off(),a._e.splice(a._e.indexOf(this),1),this},a.entity=a.e=b,a.entity.init=c}(re),function(a){var b=function(b){return new a.load.init(b)};b.path="",b.imageExt="img",b.soundExt="sfx",b.images=["gif","jpg","jpeg","png"],b.sounds=["wav","mp3","aac","ogg"];var c=function(b){if(a.is(b,"string"))this.assets=b.split(" ");else if(a.is(b,"object")){this.assets=[];for(var c in b)a.is(b[c],"array")&&(this.assets=this.assets.concat(b[c]))}else this.assets=b;var d;for(var c=0;c<this.assets.length;c++){this.total++,d=this.assets[c];var e=d,f=d.lastIndexOf("/");f!=-1&&(d=d.substr(f+1,d.length));var g=d.lastIndexOf(".")+1,h=d.substr(g).toLowerCase(),i=d.substr(0,g);if(a.load.images.indexOf(h)!=-1)this._loadImg(e,d,i);else if(a.load.sounds.indexOf(h)!=-1){if(!(window.soundManager&&h=="mp3"||a.support(h))){this.total--;continue}if(a._c[i+a.load.soundExt]){this.total--;continue}this._loadSound(e,d,i)}}return this},d=c.prototype;d.current=0,d.total=0,d._loadImg=function(b,c,d){var e=this,f=new Image;return a.c(c).alias(d+a.load.imageExt).defines({_image:f}).image=f,f.onload=function(){a.c(c).defines({sizeX:f.width,sizeY:f.height,bisect:f.width}),e._loaded()},f.onerror=function(){e._e&&e._e.call(e,c)},f.src=a.load.path+b,this},d._loaded=function(){this.current++,this.current<=this.total&&this._p&&this._p(this.current,this.total,this.assets[this.current-1]),this.current==this.total&&this._s&&this._s(this.assets)},d._loadSound=function(b,c,d){var e=this,f;if(window.soundManager)soundManager.onready(function(){f=soundManager.createSound({id:c,url:a.load.path+b,autoLoad:!0,onload:function(){e._loaded()}}),e._def_sfx(f,c,d)});else{f=new Audio(a.load.path+b),f.src=a.load.path+b,f.preload="auto",f.load();var g=function(){e._loaded(),f.removeEventListener("canplaythrough",g)};f.addEventListener("canplaythrough",g,!1),f.addEventListener("error",function(){e._e&&e._e.call(e,c)},!1),this._def_sfx(f,c,d)}},d._def_sfx=function(b,c,d){a.c(c).alias(d+a.load.soundExt).defines({_sound:b}).sound=b},d.progress=function(a){return this._p=a,this},d.complete=function(a){return this._s=a,this.assets.length==0&&a([]),this},d.error=function(a){return this._e=a,this},a.load=b,a.load.init=c}(re),function(a){var b=function(a){a&&this.query(a)};b._toObj=function(a){if(b.c[a])return b.c[a];var c=a.split(" "),d=[],e=[],f=[],g="",h,i;for(var j=c.length;j--;)h=c[j].charAt(0),i=c[j].substr(1),h=="^"?e.push(i):h=="!"?f.push(i):h=="#"?g=i:d.push(c[j]);var k={comp:d,on:e,not:f,id:g};return b.c[a]=k,k},b.c={};var c=b.prototype=new Array;c.query=function(c){c=c||"";var d=a._e.length,e=-1,f;if(a.is(c,"string")){if(c=="*")return this.push.apply(this,a._e.slice()),this;var g=b._toObj(c);while(++e<d&&(f=a._e[e]))f.has(g)&&this.push(f)}else if(a.is(c,"function"))while(++e<d&&(f=a._e[e]))c.call(f,e,d)&&this.push(f);else a.is(c,"array")&&this.push.apply(this,c);return this},c.invoke=function(a){var b=Array.prototype.slice.call(arguments,1);return this.each(function(c){c[a].apply(c,b)})},c.each=function(a,b){var c=this.length,d=-1,e;while(++d<c&&(e=this[d])!=null&&a.call(b||this,e,d,this)!==!1);return this},c.tilemap=function(a,b,c){var d=0,e=0;return this.each(function(f,g){if(b.call(c,this[f],d,e,f,this)==0)return!1;d++,d==a&&(d=0,e++)})},c.comps=function(){var a=[];return this.each(function(b){var c=b.comps();for(var d=0;d<c.length;d++)a.indexOf(c[d])==-1&&a.push(c[d])}),a},c.random=function(){return this[Math.random()*this.length|0]},c.attr=function(a,b){return this.invoke("attr",a,b)},c.def=function(a,b){return this.invoke("def",a,b)},c.comp=function(a){return this.invoke("comp",a)},c.removeComp=function(a){return this.invoke("removeComp",a)},c.on=function(a,b){return this.invoke("on",a,b)},c.off=function(a,b){return this.invoke("off",a,b)},c.trigger=function(){var a=arguments;return this.each(function(b){b.trigger.apply(b,a)})},c.has=function(a){return this.length?this.every(function(b){return b.has(a)}):!1},c.pluck=function(a){var b=[],c=a.split(" ");return this.each(function(a){var d={};for(var e in c){var f=c[e];d[f]=a[f]}b.push(d)}),b},c.isEmpty=function(){return!this.length},c.find=function(a,b){for(var c=0,d=this.length;c<d;c++)if(a.call(b||this,this[c],c,this))return this[c];return null},c.min=function(a,b){var c=Infinity,d;return this.each(function(e,f,g){var h=a.call(b||this,e,f,g);h<c&&(c=h,d=e)}),d},c.max=function(a,b){var c=-Infinity,d;return this.each(function(e,f,g){var h=a.call(b||this,e,f,g);h>c&&(c=h,d=e)}),d},c.filter=function(){return a(Array.prototype.filter.apply(this,arguments))},c.reject=function(a,b){for(var c=0;c<this.length;c++)a.call(b||this,this[c],c,this)&&this.splice(c,1);return this},c.findWith=function(a){return this.find(function(b){return b.has(a)})},c.e=function(b,c,d){var e=a.e(b,c,d);if(c)for(var f in e)this.push(e[f]);else this.push(e);return this},c.include=function(a){return this.indexOf(a)!=-1},c.erase=function(a){for(var b=this.length;b--;)this[b]==a&&this.splice(b,1);return this},c.insertAfter=function(a,b){return this.splice(this.indexOf(a)+1,0,b),this},c.insertBefore=function(a,b){return this.splice(this.indexOf(a),0,b),this},c.swap=function(a,b){var c=this.indexOf(a),d=this.indexOf(b),e=this[c];return this[c]=b,this[d]=e,this},c.dispose=function(){return this.each(function(a){a.dispose()})},c.first=function(a){return arguments.length?(this.unshift.apply(this,arguments),this):this[0]},c.last=function(a){return arguments.length?(this.push.apply(this,arguments),this):this[this.length-1]},a.query=b}(re),re.c("system").defaults({clearColor:"#f9f9f9",stepSize:.03,maxTick:.05,running:!1,sizeX:10,sizeY:10}).defines({clear:function(a){return a?(this.context.fillStyle=a,this.context.fillRect(0,0,this.sizeX,this.sizeY)):this.context.clearRect(0,0,this.sizeX,this.sizeY),this},start:function(){if(!this.running){this.running=!0;var a=this;(function b(){a.system_loop(),a.running&&a.requestAnimationFrame(b,a.canvas)})()}return this},loop:function(a){return this.system_loop=a,this},stop:function(){return this.running=!1,this},init:function(a,b){this.comp("polyfill tick timestep"),re.is(a,"htmlcanvaselement")?this.canvas=a:this.canvas=re.$(a),this.context=this.canvas.getContext(b||"2d");var c=re.screen=re.e("screen");return this.sizeX=c.sizeX=this.canvas.width,this.sizeY=c.sizeY=this.canvas.height,re.keyboard&&re.keyboard.i(),re.mouse&&re.mouse.i(),re.touch&&re.touch.i(),this.system_loop=this.defaultLoop,this.second=this.stepSize*30,this},defaultLoop:function(){this.timestep(Math.min(this.tick()/1e3,this.maxTick),function(){this.update()}),this.clear(this.clearColor),this.draw()},update:function(){re.update.update(this.stepSize)},draw:function(){re.drawlist().drawlist(this.context)}}),re.system=re.sys=re.e("system"),re.c("drawlist").method(function(a){var a=a||"";return re.drawlist._lists[a]||re.e("drawlist:"+a),re.drawlist._lists[a]}).statics({_lists:{}}).defines({add:function(a){return a.drawlist&&a.drawlist.remove(a),a.drawlist=this,this.list.last(a),this},remove:function(a){return a.drawlist&&(this.list.erase(a),a.drawlist=null),this},drawlist:function(a){var b=this.list;for(var c=0,d;c<b.length;c++)d=b[c],d.visible()&&d.render(a)},sort:function(){this.list.sort(function(a,b){return a.depth&&b.depth?a.depth()-b.depth():0})}}).init(function(a){re.drawlist._lists[a]=this,this.listName=a,this.list=re()}).dispose(function(){delete re.drawlist._lists[this.listName]}),re.c("tick").init(function(){this.lastTime=Date.now()}).defines({tick:function(){var a=Date.now(),b=this.lastTime;return this.lastTime=a,a-b}}),re.c("tween").requires("update").namespaces({update:function(a){if(!this.tweening)return;this.tween_time+=a;var b=this.tween_time/this.tween_t;b>1&&(b=1),value=this.tweenEase(b);for(var c in this.tween_d){var d=this.tween_s[c]+this.tween_d[c]*value;re.is(this[c],"function")?this[c](d):this[c]=d}this.trigger("tween:update",value),b==1&&(this.tweening=!1,this.off("update",this.tween_update),this.trigger("tween:finish"))}}).defaults({tweening:!1,tweenEase:function(a){return a}}).defines({tween:function(a,b){a>=100&&(a/=1e3);var c=(a||1)/re.sys.second;this.tween_time=0;var d={},e={};for(var f in b){var g=this[f];re.is(g,"function")&&(g=g()),d[f]=b[f]-g,e[f]=g}return this.tween_s=e,this.tween_d=d,this.tween_t=c,this.tweening||this.on("update",this.tween_update),this.tweening=!0,this.trigger("tween:start",e)}}),re.tween=function(a,b,c){return a.comp("tween").tween(b,c)},re.c("update").statics({l:[],update:function(a){var b=this.l;for(var c=0,d;c<b.length;c++)d=b[c],d&&d.updatable&&d.trigger("update",a)}}).defaults({updatable:!0}).defines(function(){var a=re.update.l;return{updateFirst:function(){return a.splice(a.indexOf(this),1),a.unshift(this),this},updateLast:function(){return a.splice(a.indexOf(this),1),a.push(this),this},updateAfter:function(b){var c=a.indexOf(b),d=a.indexOf(this);if(c>d){var e=a[c];a[c]=a[d],a[d]=e}return this},updateBefore:function(b){var c=a.indexOf(b),d=a.indexOf(this);if(c<d){var e=a[c];a[c]=a[d],a[d]=e}return this}}}()).init(function(){re.update.l.push(this)}).dispose(function(){re.update.l.splice(re.update.l.indexOf(this),1)}),re.c("align").defaults({regX:0,regY:0,sizeX:1,sizeY:1,posX:0,posY:0}).defines({align:function(a,b){return this.alignHor(a),this.alignVer(b)},alignHor:function(a){return a=a||0,this.set("posX",re.sys.sizeX*.5-(this.get("sizeX")-this.get("regX"))*.5+a|0),this},alignVer:function(a){return a=a||0,this.set("posY",re.sys.sizeY*.5-(this.get("sizeY")-this.get("regY"))*.5+a|0),this},alignRight:function(a){return a=a||0,this.set("posX",re.sys.sizeX-(this.get("sizeX")-this.get("regX"))+a|0),this},alignLeft:function(a){a=a||0;var b=this.get("sizeX");return this.set("posX",a+b-(b-this.get("regX"))|0),this},alignTop:function(a){a=a||0;var b=this.get("sizeY");return this.set("posY",a+b-(b-this.get("regY"))|0),this},alignBottom:function(a){return a=a||0,this.set("posY",re.sys.sizeY-(this.get("sizeY")-this.get("regY"))+a|0),this}}),re.c("animate").requires("flicker").defines({flicker_stop:function(){this._super("flicker","flicker_stop"),this.animate_finish&&this.animate_finish()},animate:function(a,b,c){if(this.flickering()!=a){this.animate_finish=b,this.animate_update=c;var d=this.animates[a];this.flicker(d[0],d[1],d[2],a),d.push&&this.flicker_run()}return this},animating:function(a){return this.flickering(a)},flick:function(a){this.frame(a),this.animate_update&&this.animate_update.apply(this,arguments)}}),re.c("circle").requires("draw").defaults({color:"#82d5f4"}).defines({draw:function(a){a.fillStyle=this.color,a.beginPath();var b=this.radius();return a.arc(-this.regX+b,-this.regY+b,b,0,Math.PI*2,!0),a.closePath(),a.fill(),this},radius:function(a){return re.is(a)?(this.sizeX=this.sizeY=a*2,this):this.sizeX*.5}}),re.c("draw").interfaces("draw").init(function(){re.drawlist().add(this)}).dispose(function(a){this.drawlist.remove(this)}).defaults({screenable:!0,drawable:!0,rotation:0,alpha:1,scaleX:1,scaleY:1,posX:0,posY:0,sizeX:10,sizeY:10,regX:0,regY:0}).defines({depth:function(){return this.posY},drawFirst:function(){var a=this.drawlist.list;return a.splice(a.indexOf(this),1),a.unshift(this),this},drawLast:function(){var a=this.drawlist.list;return a.splice(a.indexOf(this),1),a.push(this),this},drawAfter:function(a){var b=this.drawlist.list,c=b.indexOf(a),d=b.indexOf(this);if(c>d){var e=b[c];b[c]=b[d],b[d]=e}return this},drawBefore:function(a){var b=this.drawlist.list,c=b.indexOf(a),d=b.indexOf(this);if(c<d){var e=b[c];b[c]=b[d],b[d]=e}return this},screenX:function(a){return a?(this.posX=a+re.screen.posX,this):this.posX-re.screen.posX},screenY:function(a){return a?(this.posY=a+re.screen.posY,this):this.posY-re.screen.posY},render:function(a){this.draw_before(a),this.draw(a),this.draw_after(a)},visible:function(){return this.drawable&&re.screen.hit(this.posX-this.regX,this.posY-this.regY,this.sizeX,this.sizeY)}}).namespaces({before:function(a){a.save(),this.alpha-1&&(a.globalAlpha=this.alpha),this.screenable?a.translate(this.screenX(),this.screenY()):a.translate(this.posX,this.posY),this.rotation&&a.rotate(this.rotation*Math.PI/180),(this.scaleX!=1||this.scaleY!=1)&&a.scale(this.scaleX,this.scaleY)},after:function(a){a.restore()}}),re.c("el").requires("align").defines({posX:function(a){return re.is(a)?this.$el.css("left",a):this.$el.position().left},posY:function(a){return re.is(a)?this.$el.css("top",a):this.$el.position().top},sizeX:function(){return this.$el.outerWidth()},sizeY:function(){return this.$el.outerHeight()},click:function(a){var b=this;return this.$el.click(function(c){return a.call(b,c),!1}),this},$:function(a,b){return this.$el.find(a,b)},setEl:function(a){return this.remove(),this.el=a,this.$el=$(a).addClass("el"),this.posX(0),this.posY(0),this},text:function(a){return re.is(a)?(this.$el.text(a),this):this.$el.text()},place:function(){return $(re.sys.canvas).parent().append(this.el),this},remove:function(){return this.$el&&(this.$el.remove(),this.$el=this.el=null),this},hide:function(){return this.$el.hide(),this},show:function(){return this.$el.show(),this}}).init(function(a){a&&this.setEl(re.$new(a))}).dispose(function(){this.remove()}),re.c("group").defaults({posX:0,posY:0}).defines({group:function(){for(var a=0;a<arguments.length;a++)arguments[a].comp("group").group},ungroup:function(a){},getScreenX:function(){var a=this.posX;return this.group&&(a+=this.group.posX),this.screen&&(a+=this.screen.posX),a},getScreenY:function(){var a=this.posY;return this.group&&(a+=this.group.posY),this.screen&&(a+=this.screen.posY),a},getGroupX:function(){var a=this.posX;return this.group&&(a+=this.group.posX),a},getGroupY:function(){var a=this.posY;return this.group&&(a+=this.group.posY),a},setGroupX:function(a){},setGroupY:function(a){}}),re.c("image").requires("draw").defines({image:function(a){return re.is(a)?(this.attr({_image:a,sizeX:a.width,sizeY:a.height}),this):this._image},visible:function(){return this._image&&this._super("draw","visible")},draw:function(a){return a.drawImage(this._image,-this.regX,-this.regY,this.sizeX,this.sizeY),this}}).init(function(){this._image&&this.image(this._image)}),re.c("imgtext").requires("draw").interfaces("imgtext").defaults({charOffset:32,lineHeight:15}).defines({visible:function(){return this._text&&this._image&&this._super("draw","visible")},draw:function(a){for(var b=0;b<this.text_lines.length;b++)this.drawText(a,this.text_lines[b],b*this.lineHeight);return this},drawText:function(a,b,c){var d=0,e,f,g;for(var h=0,i=b.length;h<i;++h){f=b.charCodeAt(h)-this.charOffset,e=this.imgtext[f];if(!this.charCache[f]){g=0;for(var j=0;j<f;++j)g+=this.imgtext[j]+1;this.charCache[f]=g}a.drawImage(this._image,this.charCache[f],0,e,this._image.height,-this.regX+d,-this.regY+c,e,this._image.height),d+=e}},text:function(a){if(re.is(a)){this._text=a,this.text_lines=this._text.split("\n"),this.sizeX=0;for(var b in this.text_lines){var c=0;for(var d=0;d<this.text_lines[b].length;d++)c+=this.imgtext[d];c>this.sizeX&&(this.sizeX=c)}return this.sizeY=this.text_lines.length*this.lineHeight,this}return this._text}}).init(function(){this.charCache||(this.charCache={}),this.text("")}),re.c("rect").requires("draw").defaults({color:"#82d5f4"}).defines({draw:function(a){return a.fillStyle=this.color,a.fillRect(-this.regX,-this.regY,this.sizeX,this.sizeY),this}}),re.c("screen").requires("hit").defines({pos:function(a,b){return arguments.length?(re.is(a,"object")&&(b=a.posY,a=a.posX),this.posX=a-this.regX,this.posY=b-this.regY,this):this},toScreenX:function(a){return a+this.posX+this.offX},toScreenY:function(a){return a+this.posY+this.offY}}).defaults({posX:0,posY:0,regX:0,regY:0,sizeX:0,sizeY:0,offX:0,offY:0}),re.c("sprite").requires("image bisect").defaults({frameX:0,frameY:0}).defines({frame:function(a){return re.is(a)?(this.frameX=this.biToTileX(a),this.frameY=this.biToTileY(a),this):this.tileToBi(this.frameX,this.frameY)},draw:function(a){return a.drawImage(this._image,this.frameX*this.sizeX,this.frameY*this.sizeY,this.sizeX,this.sizeY,-this.regX,-this.regY,this.sizeX,this.sizeY),this}}),re.c("text").requires("draw").defaults({font:"14px sans-serif",textColor:"#000000",textAlign:"left",textBaseline:"top",lineHeight:15}).defines({visible:function(){return this._text&&this._super("draw","visible")},text:function(a){if(re.is(a)){a=Array.prototype.join.call(arguments," "),this.text_lines=a.split("\n"),this._text=a;if(re.sys.context){var b=re.sys.context;b.save(),b.font=this.font,this.sizeX=0;var c=0;for(var d in this.text_lines)c=b.measureText(this.text_lines[d]).width,c>this.sizeX&&(this.sizeX=c);b.restore()}return this.sizeY=this.text_lines.length*this.lineHeight,this}return this._text},draw:function(a){a.font=this.font,a.fillStyle=this.textColor,a.textAlign=this.textAlgin,a.textBaseline=this.textBaseline;var b=this.text_lines;for(var c=0,d=b.length;c<d;c++)a.fillText(b[c],-this.regX,-this.regY+c*this.lineHeight);return this}}),re.c("keyboard").statics({l:[],keyCodes:{65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",16:"shift",17:"ctrl",18:"alt",24:"cmd",255:"fn",8:"backspace",13:"enter",32:"space",27:"esc",9:"tab",20:"capslock",91:"windows",46:"delete",36:"home",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",96:"`",45:"-",187:"=",219:"[",221:"]",220:"\\",59:";",222:"'",188:",",190:".",191:"/"},event:function(a){var b=re.keyboard,c=(a.target||a.srcElement||{}).tagName;if(c=="INPUT"||c=="SELECT"||c=="TEXTAREA")return;var d=a.keyCode||a.which,e=b.keyCodes[d];re.pressed&&re.pressed.d&&(re.pressed.d[e]=a.type=="keydown"),re.preventDefault&&re.preventDefault.d[e]&&a.preventDefault();for(var f=0;f<b.l.length;f++)b.l[f].trigger(a.type,e,a).trigger(a.type+":"+e,e,a)},i:function(){re.listener("keydown",this.event),re.listener("keyup",this.event),re.listener("focus",function(){re.pressed.d={}})}}).init(function(){re.keyboard.l.push(this)}).dispose(function(){re.keyboard.l.splice(re.keyboard.l.indexOf(this),1)}),re.c("mouse").statics({l:[],press:function(a){var b,c;a.which==null?a.button<2?b="left":a.button==4?b="middle":b="right":a.which<2?b="left":a.which==2?b="middle":b="right",c="mouse:"+b,re.pressed.d&&(re.pressed.d[c]=a.type=="mousedown"),re.mouse.event(a,c)},event:function(a,b){var c=re.sys.canvas,d=c.width/c.offsetWidth,e=c.height/c.offsetHeight;a.offsetX!=null?(d*=a.offsetX,e*=a.offsetY):(d*=a.layerX-c.offsetLeft,e*=a.layerY-c.offsetTop);var f=re.mouse.l,g,h,i,j,k;for(var l=0;l<f.length;l++)h=f[l],h.screenable?(j=re.screen.toScreenX(d),k=re.screen.toScreenY(e)):(j=d,k=e),j+=h.offX,k+=h.offY,h.trigger(a.type,j,k,a),b&&h.trigger(a.type+":"+b,j,k,a)},i:function(){var a=re.sys.canvas;re.listener("mousedown",this.press,a),re.listener("mouseup",this.press,a),re.listener("mousemove",this.event,a),re.listener("mouseover",this.event,a),re.listener("mouseout",this.event,a),re.listener("click",this.event,a),re.listener("dblclick",this.event,a),re.listener("contextmenu",this.event,a)}}).defaults({offX:0,offY:0}).init(function(){re.mouse.l.push(this)}).dispose(function(){re.mouse.l.splice(re.mouse.l.indexOf(this),1)}),re.pressed=function(a){var b=arguments;re.is(a,"array")&&(b=a);for(var c=0,d=b.length;c<d;c++)if(re.pressed.d[b[c]])return!0;return!1},re.pressed.d={},re.preventDefault=function(a){re.is(a,"string")&&(a=a.split(" "));for(var b in a)re.preventDefault.d[a[b]]=1},re.preventDefault.d={},re.c("bisect").statics({toX:function(a,b,c){return this.toTileX(a,b,c)*c},toY:function(a,b,c){return this.toTileY(a,b,c)*c},toTileX:function(a,b,c){return a%(b/c)|0},toTileY:function(a,b,c){return a*c/(b-.1)|0},tileToBi:function(a,b,c,d){return a+b*(c/d)}}).defines({biToX:function(a){return re.bisect.toX(a,this.bisect,this.sizeX)},biToY:function(a){return re.bisect.toY(a,this.bisect,this.sizeX)},biToTileX:function(a){return re.bisect.toTileX(a,this.bisect,this.sizeX)},biToTileY:function(a){return re.bisect.toTileY(a,this.bisect,this.sizeX)},tileToBi:function(a,b){return re.bisect.tileToBi(a,b,this.bisect,this.sizeX)}}).defaults({bisect:1,sizeX:1,sizeY:1}),re.c("body").defines({hit:function(a,b,c,d,e,f){re.is(a,"object")&&(b=a.posY||a.y,c=a.sizeX||a.w,d=a.sizeY||a.h,e=a.regX||0,f=a.regY||0,a=a.posX||a.x),e=e||0,f=f||0;var g=this.regX||0,h=this.regY||0;return!(a-e>this.posX+this.bodyX-this.padX-g||a+c-e<this.posX+this.padX-g||b-f>this.posY+this.bodyY-this.padY-h||b+d-f<this.posY+this.padY-h)},hitBody:function(a,b,c,d,e,f,g,h){re.is(a,"object")&&(b=a.posY||a.y,c=a.bodyX,d=a.bodyY,e=a.padX,f=a.padY,g=a.regX||0,h=a.regY||0,a=a.posX||a.x),g=g||0,h=h||0;var i=this.regX||0,j=this.regY||0;return!(a+e-g>this.posX+this.bodyX+this.padX-i||a+c-e-g<this.posX+this.padX-i||b+f-h>this.posY+this.bodyY-this.padY-j||b+d-f-h<this.posY+this.padY-j)}}).defaults({posX:0,posY:0,padX:0,padY:0,bodyX:1,bodyY:1}),re.distance=function(a,b,c,d){var e,f;return e=c-a,f=d-b,Math.sqrt(e*e+f*f)},re.c("drag").defaults({posX:0,posY:0,dragX:0,dragY:0,dragging:!1}).defines({dragStart:function(a,b){return this.dragging||(this.dragging=!0,this.dragX=a,this.dragY=b,this.trigger("drag:start")),this},dragFinish:function(){return this.dragging=!1,this.trigger("drag:finish")},dragUpdate:function(a,b){return this.dragging&&(this.posX+=a-this.dragX,this.posY+=b-this.dragY,this.dragX=a,this.dragY=b,this.trigger("drag:update")),this}}),re.c("force").requires("update").statics({graX:0,graY:0}).defaults({posX:0,posY:0,velX:0,velY:0,friX:.4,friY:.4,accX:0,accY:0,resX:.4,resY:.4,mass:1}).namespaces({update:function(){this.velX=this.force(this.velX,this.accX,this.friX,this.graX,this.mass),this.velY=this.force(this.velY,this.accY,this.friY,this.graY,this.mass),this.hitmap?this.aftermath(this.hitmap.checkHit(this)):this.aftermath(this.posX+this.velX,this.posY+this.velY)}}).defines({aftermath:function(a,b,c,d,e,f){return re.is(a,"object")&&(c=a.hitX,d=a.hitY,e=a.tarX,f=a.tarY,b=a.posY,a=a.posX),this.posX=a,this.posY=b,c&&(this.velX=this.forceRes(this.velX,this.resX)),d&&(this.velY=this.forceRes(this.velY,this.resY)),this.trigger("aftermath",c,d,e,f)},forceRes:function(a,b){return a*-b},forceGra:function(a,b){return a*b},forceVel:function(a,b,c){return(a+b)*c},force:function(a,b,c,d,e){var f=this.forceVel(a,b,c)+this.forceGra(d,e);return Math.abs(f)<.01&&(f=0),f},isIdle:function(a){return a=a||0,Math.abs(this.velY+this.velX+this.accX+this.accY)<=a}}).init(function(){this.def({hitmap:re.hitmap,graX:re.force.graX,graY:re.force.graY}),this.on("update",this.force_update)}).dispose(function(){this.off("update",this.force_update)}),re.c("hit").defaults({posX:0,posY:0,sizeX:1,sizeY:1,hit:function(a,b,c,d,e,f){re.is(a,"object")&&(b=a.posY||a.y,c=a.sizeX||a.w,d=a.sizeY||a.h,e=a.regX||0,f=a.regY||0,a=a.posX||a.x),e=e||0,f=f||0;var g=this.regX||0,h=this.regY||0;return!(a-e>this.posX+this.sizeX-g||a+c-e<this.posX-g||b-f>this.posY+this.sizeY-h||b+d-f<this.posY-h)}}),re.c("hitmap").requires("automap").defines({hitValue:1,checkAxisX:function(a,b,c,d,e){return a==this.hitValue},checkAxisY:function(a,b,c,d,e){return a==this.hitValue},checkHit:function(a,b,c,d,e,f,g,h){re.is(a,"object")&&(c=a.velX,d=a.velY,e=a.bodyX||a.sizeX,f=a.bodyY||a.sizeY,g=a.padX||0,h=a.padY||0,b=a.posY,a=a.posX);var i={posX:a,posY:b},j=Math.max(Math.abs(c),Math.abs(d))/((re.tile.sizeX+re.tile.sizeY)*.5)+.5|0;if(j>1){var k=c/j,l=d/j;for(var m=0;m<j&&(k||l);m++)this.hitmap_step(i,a,b,k,l,e,f,h,h),i.hitX&&(k=0),i.hitY&&(l=0)}else this.hitmap_step(i,a,b,c,d,e,f,g,h);return i}}).namespaces({step:function(a,b,c,d,e,f,g,h,i){a.posX+=d,a.posY+=e;var j,k,l;if(d){j=re.tile.sizeX;var m=d>0?f-h:h,n=Math.floor((c+i)/j),o=Math.ceil((c+g-i)/j);l=Math.floor((b+d+m)/j);var p=d<0?j:0;if(l>=0&&l<this.lenX&&o>=0&&n<this.lenY)for(k=n;k<o;k++)if(this._automap[k]){this.trigger("hit",this._automap[k][l],l,k);if(this.checkAxisX(this._automap[k][l],b,c,d,e)){a.hitX=!0,a.posX=l*j+p-m,a.tarX=l*j,a.tarY=k*j;break}}}if(e){j=re.tile.sizeY;var q=e>0?g-i:i,r=Math.floor((a.posX+h)/j),s=Math.ceil((a.posX+f-h)/j);k=Math.floor((c+e+q)/j);var t=e<0?j:0;if(k>=0&&k<this.lenY&&s>=0&&r<this.lenX)for(l=r;l<s;l++)if(this._automap[k]){this.trigger("hit",this._automap[k][l],l,k);if(this.checkAxisY(this._automap[k][l],b,c,d,e)){a.hitY=!0,a.posY=k*j+t-q,a.tarX=l*j,a.tarY=k*j;break}}}}}),re.hitmap=null,re.c("iso").statics({sizeX:30,sizeY:30,sizeZ:30,toPosX:function(a,b){var c=this.toIsoX(a,b),d=this.toIsoY(a,b);return(c-d)*this.sizeX},toPosY:function(a,b){var c=this.toIsoX(a,b),d=this.toIsoY(a,b);return(c+d)*this.sizeY*.5},toPos:function(a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),{posX:this.toPosX(a,b),posY:this.toPosY(a,b)}},toIsoX:function(a,b){var c=(2*b-a)*.5,d=a+c;return Math.round(d/this.sizeX)-1},toIsoY:function(a,b){var c=(2*b-a)*.5;return Math.round(c/this.sizeY)},toIso:function(a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),{isoX:this.toIsoX(a,b),isoY:this.toIsoY(a,b)}}}).defaults({posX:0,posY:0,posZ:0}).defines({iso:function(a,b,c){if(re.is(a,"object")){c=a.z,re.is(a.posZ)&&(c=a.posZ/re.iso.sizeZ),b=a.y;if(re.is(a.posX)&&re.is(a.posY))return this.posX=a.posX,this.posY=a.posY,a.posZ&&(this.posZ=a.posZ),this;a=a.x}return a=re.is(a)?a:this.isoX(),a*=re.iso.sizeX,b=re.is(b)?b:this.isoY(),b*=re.iso.sizeY,c=re.is(c)?c:this.isoZ(),c*=re.iso.sizeZ,this.posX=a-b,this.posY=(a+b)*.5-c,this.posZ=c,this},isoX:function(a){return re.is(a)?this.iso(a):(this.posX+(2*(this.posY+this.posZ)-this.posX)*.5)/re.iso.sizeX},isoY:function(a){return re.is(a)?this.iso({y:a}):(2*(this.posY+this.posZ)-this.posX)*.5/re.iso.sizeY},isoZ:function(a){return re.is(a)?this.iso({z:a}):this.posZ/re.iso.sizeZ},onIso:function(){var a=this.isoX()+this.isoY()+this.isoZ();return(a|0)==a}}),re.c("limit").defines("limit",function(a){var b=arguments;return this[a]<b[1]?this[a]=b[1]:re.is(b[2])&&this[a]>b[2]&&(this[a]=b[2]),this}),re.c("point").defaults({posX:0,posY:0}).defines({pos:function(a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),this.posX=a,this.posY=b,this},distance:function(
a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),re.distance(this.posX,this.posY,a,b)}}),re.random=function(a,b){var c=Math.random();if(re.is(a,"array"))return a[c*a.length|0];if(re.is(a,"object")){var d;for(var e in a)if(Math.random()<1/++c||!re.is(d))d=e;return d}switch(arguments.length){case 0:return c;case 1:return c*a;case 2:return c*(a-b+1)+b}},re.randomInt=function(){return re.random.apply(this,arguments)|0},re.range=function(a,b,c){var d=[];for(var e=a||0;e<b;e+=c||1)d.push(e);return d},re.c("tile").statics({sizeX:40,sizeY:40,toPosX:function(a){return this.toTileX(a)*this.sizeX},toPosY:function(a){return this.toTileY(a)*this.sizeY},toPos:function(a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),{posX:this.toPosX(a),posY:this.toPosY(b)}},toTileX:function(a){return(a-this.sizeX*.5)/this.sizeX+.5|0},toTileY:function(a){return(a-this.sizeY*.5)/this.sizeY+.5|0},toTile:function(a,b){return re.is(a,"object")&&(b=a.posY||a.y,a=a.posX||a.x),{tileX:this.toTileX(a),tileY:this.toTileY(b)}}}).defaults({posX:0,posY:0,regX:0,regY:0}).defines({tile:function(a,b){return re.is(a,"object")&&(b=a.y||re.tile.toTileY(a.posY),a=a.x||re.tile.toTileX(a.posX)),this.tileX(a),this.tileY(b),this},tileX:function(a){return re.is(a)?(this.posX=a*this.sizeX+.5|0,this):this.posX/this.sizeX+.5|0},tileY:function(a){return re.is(a)?(this.posY=a*this.sizeY+.5|0,this):this.posY/this.sizeY+.5|0}}).init(function(){this.sizeX=re.tile.sizeX,this.sizeY=re.tile.sizeY}),re.c("playlist"),re.c("sound").statics({enabled:!0}).defaults({playing:!1}).namespaces({e:!1,ended:function(){this.trigger("sound:finish")}}).defines({play:function(){if(!this._sound||!re.sound.enabled)return this;this.playing&&this.stop();var a=this._sound,b=this;if(window.soundManager)a.play({onfinish:function(){b.sound_ended()}});else{a.currentTime=0;if(!this.sound_e){this.sound_e=!0;var c=function(){b.sound_ended(),a.removeEventListener("ended",c),b.sound_e=!1};a.addEventListener("ended",c,!1)}a.play()}return this},resume:function(){return this._sound.play(),this.playing=!0,this},pause:function(){return this._sound.pause(),this.playing=!1,this}}),re.c("automap").defaults({lenX:0,lenY:0,automapDefault:0}).defines({automap:function(a,b,c){if(re.is(a,"array")){if(b)for(var b=0;b<a.length;b++)for(var d=0;d<a[0].length;d++)this.automap(d,b,a[b][d]);else this._automap=a,a.length>0?this.lenX=a[0].length:this.lenX=0,this.lenY=a.length;return this}if(!re.is(c))return this.within(a,b)?this._automap[b][a]:null;while(b>=this._automap.length){var e=new Array(this._automap[0]);for(var f in e)e[f]=this.automapDefault;this._automap.push(e)}while(a>=this._automap[this._automap.length-1].length)for(var d=0;d<this._automap.length;d++)this._automap[d].length<=a&&this._automap[d].push(this.automapDefault);return this.lenX=this._automap[b].length,this.lenY=this._automap.length,this._automap[b][a]=c,this},within:function(a,b){return b<0||b>=this.lenY||a<0||a>=this.lenX?!1:!0}}).init(function(){this._automap=[]}),re.c("flicker").requires("update timestep").interfaces("flick").namespaces({flickering:"",stop:function(){var a=this.flicker_id;return this.flicker_id="",this.stepProgress=0,this.off("update",this.flicker_update),this.trigger("flicker:finish",a)},change:function(){if(this.flicker_frame==this.flicker_frames.length){if(!(this.flicker_loops==-1||--this.flicker_loops>=1)){this.flicker_stop();return}this.flicker_frame=0}this.flicker_run()},run:function(){var a=this.flicker_frame,b=this.flicker_frames,c=this.flicker_loops,d=b[a],e=this.flick(d,a,b,c);this.trigger("flicker:update",d,a,b,c),e===!1&&this.flicker(),this.flicker_frame++},update:function(a){this.timestep(a,this.flicker_change)}}).defines({flicker:function(a,b,c,d){return!re.is(a)&&this.flickering()?this.flicker_stop():(a>=100&&(a/=1e3),this.flicker_duration=a||1,b=re.is(b,"array")?b:[b],this.flicker_loops=c||1,this.stepProgress=0,this.stepSize=a/b.length/re.sys.second,this.flicker_frames=b,this.flicker_frame=0,this.flickering()||this.on("update",this.flicker_update),this.flicker_id=d||!0,this.trigger("flicker:start"),this)},flickering:function(a){return a?this.flicker_id==a:this.flicker_id}}),re.c("pathfind").method(function(){var a=re.e("pathfind"),b=a.pathfind.apply(a,arguments);return a.dispose(),b}).defines({pathfind_max:100,pathfind:function(a,b,c,d,e,f){this.targetX=c,this.targetY=d,this.onCheck=e,this.onTile=f,this.visit={},this.nodes=[],this.addNode(a,b,-1,-1);var g,h=0;while(this.nodes.length){g=this.nodes.shift();if(g.x==this.targetX&&g.y==this.targetY)return this.makePath(g);this.searchNodes(g.x,g.y,g.px,g.py);if(++h>=this.pathfind_max)return null}return null},searchNodes:function(a,b){this.addNode(a+1,b,a,b),this.addNode(a-1,b,a,b),this.addNode(a,b+1,a,b),this.addNode(a,b-1,a,b)},checkNode:function(){return!0},makePath:function(a){var b=[],c=0;do b[c++]=a.x,b[c++]=a.y,a=this.nodes[a.px+"_"+a.py];while(a&&a.px!=-1);return b},addNode:function(a,b,c,d){if(!this.checkNode(a,b,c,d)||this.onCheck&&!this.onCheck(a,b,c,d))return!1;var e=a+"_"+b,f=re.distance(a,b,this.targetX,this.targetY);if(!this.nodes[e]||this.nodes[e].cost>f){var g=this.nodes[e]={x:a,y:b,cost:f,px:c,py:d},h=!1;for(var i=0,j=this.nodes.length;i<j;i++)if(f<this.nodes[i].cost){this.nodes.splice(i,0,g),h=!0;break}return h||this.nodes.push(g),this.onTile&&this.onTile(a,b,c,d,f),!0}}}),re.c("timestep").defaults({stepProgress:0,stepSize:100}).defines({timestep:function(a,b,c){this.stepProgress+=a;while(this.stepProgress>=this.stepSize){b.call(c||this),this.stepProgress-=this.stepSize;if(!this.stepSize)break}}}),re.c("storage").init(function(a){this.storage=window[a+"Storage"]}).defines({length:function(){return this.storage.length},key:function(a){return this.storage.key(a)},item:function(a,b){return re.is(b)?(this.storage.setItem(a,JSON.stringify(b)),this):JSON.parse(this.storage.getItem(a))},removeItem:function(a){return this.storage.removeItem(a),this},clear:function(){return this.storage.clear(),this}}),re.clone=function(a){if(!re.is("object"))return a;if(re.is(a,"array"))return a.slice();var b={};for(var c in a)b[c]=a[c];return b},re.log=function(a){console.log(a)},re.c("polyfill").defines({requestAnimationFrame:function(a,b){return requestAnimFrame(a,b)}}).run(function(){requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}),re.c("scene").statics({_scenes:{}}).method(function(a){var b=re.scene;return re.is(a)?(b._scenes[a]||re.e("scene:"+a),b._scenes[a]):b._scenes[re.scene.current]}).init(function(a){re.scene._scenes[a]=this,this.sceneName=a}).dispose(function(){delete re.scene._scenes[this.sceneName]}).defines({clear:function(){return re("el").query("draw").dispose(),this},enter:function(a){return re.is(a,"function")?this.scene_enter=a:(re.scene.current&&re.scene().exit(),re.scene.current=this.sceneName,this.scene_enter&&this.scene_enter.apply(this,arguments)),this},exit:function(a){return re.is(a,"function")?this.scene_exit=a:(re.scene.current="",this.scene_exit&&this.scene_exit.apply(this,arguments)),this}}),re.sheet=function(a,b,c,d){var e=c||re.tile.sizeX,f=d||re.tile.sizeY;re.is(b,"array")&&(b=b.join(" "));var g,h,i=[];for(var j in a)g=a[j][0]||0,h=a[j][1]||0,i.push(j),re.c(j).requires("sprite "+b).defines({frameX:g,frameY:h,sizeX:e,sizeY:f});return i},re.support=function(a){if(arguments.length>1){var b;for(var c=0;c<arguments.length;c++){b=arguments[c];if(re.support(b))return b}return!1}var d=a.split(" "),e=!0;for(var f in d)e=e&&!!re.support[d[f]];return e};var c=re.support;c.canvas=!!document.createElement("canvas").getContext,c.text=!!c.canvas&&typeof document.createElement("canvas").getContext("2d").fillText=="function";var ele=document.createElement("audio");try{if(c.audio=!!ele.canPlayType){c.ogg=ele.canPlayType('audio/ogg; codecs="vorbis"'),c.mp3=ele.canPlayType("audio/mpeg;"),c.wav=ele.canPlayType('audio/wav; codecs="1"'),c.aac=ele.canPlayType("audio/x-m4a;")||ele.canPlayType("audio/aac;");for(var i in c)if(c[i]=="no"||c[i]=="")c[i]=!1}}catch(e){}try{c.localstorage=!!localStorage.getItem}catch(e){c.localstorage=!1}c.worker=!!window.Worker,c.webgl=!!window.WebGLRenderingContext,c.touch="ontouchstart"in window,re.c("cliff").requires("image cliff.png").defines({posX:0,posY:150,scaleX:.3}),re.c("hero").requires("image bearPurple.png").defines({posX:180,posY:120}),re.c("line").requires("draw").defines({draw:function(a){return pole=re("pole").first(),lure=re("lure").first(),pole&&lure&&(lure.flying||lure.floating)&&(pAngle=pole.rotation,pHip=pole.scaledSizeX(),angle=degreeToRadian(pAngle*-1),hip=pHip,co=Math.sin(angle)*hip,ca=Math.cos(angle)*hip,a.strokeStyle="#000000",a.lineWidth=.1,a.beginPath(),a.moveTo(pole.posX+ca,pole.posY-co+5),a.lineTo(lure.posX+lure.sizeX/2,lure.posY+lure.sizeY/2),a.closePath(),a.stroke()),this}}),re.c("water").requires("image watertile.png").defines({posX:0,posY:180}),re.ready(function(){re.sys.init(re.canvas).start(),re.scene("load").enter()}),re.scene("load").enter(function(){re.force.graY=30*re.sys.stepSize,re.load(re.assets).complete(function(){re.scene("home").enter()})}),re.c("pole").requires("image fishingRod1.png update keyboard mouse").defines({height:50,rotation:0,casting:!1,angularVel:10,scaleX:.5,scaleY:.5,castingDirection:-1,update:function(){this.casting&&this.angularMovement()},angularMovement:function(){this.rotation+=this.castingDirection*this.angularVel,this.changeDirection(),this.rotation>0&&(this.castingDirection*=-1,this.stopCasting())},changeDirection:function(){this.rotation<=-180&&(this.castingDirection*=-1)},stopCasting:function(){this.casting=!1,this.rotation=0},startCasting:function(){this.casting||(this.rotation=0),this.lure==null&&(this.lure=re.e("lure"),this.lure.setPole(this)),this.casting=!0},throwLure:function(){this.lure.castFromPole(this),this.lure=null,this.castingDirection==-1&&(this.castingDirection*=-1)},scaledSizeX:function(){return this.sizeX*this.scaleX}}).init(function(){this.lure=re.e("lure"),this.lure.setPole(this),this.on("update",this.update),this.on("mousedown",this.startCasting),this.on("mouseup",this.throwLure)}).dispose(function(){}),re.scene("home").enter(function(){re.preventDefault("a"),this.level=re("level1.tmx")[0];var a=re.e("water");re.e("cliff"),re.e("hero"),re.e("line"),pole=re.e("pole").attr("posX",210).attr("posY",130),re.e("text align").text("Click to cast!").alignTop(5).alignLeft(5)}),re.c("lure").requires("image lureSmall.png update force").defines({color:"rgb(100, 200, 200)",radius:5,flying:!1,attached:!0,castedAngle:0,floating:!1,radiusIncrement:0,setPole:function(a){this.pole=a,this.posX=a.posX,this.posY=a.posY-a.sizeX*a.scaleX},update:function(){this.posY>=re("water")[0].posY&&(this.flying=!1,this.floating=!0),this.attached?this.moveFromPole():this.flying&&this.moveFlying(),this.posY>400&&this.dispose()},moveFlying:function(){this.castedAngle+=5,this.flyingRadius+=this.radiusIncrement,this.move(this.castedAngle,this.flyingRadius)},moveFromPole:function(){this.move(this.pole.rotation,this.pole.scaledSizeX())},move:function(a,b){angle=degreeToRadian(a*-1),hip=b,co=Math.sin(angle)*hip,ca=Math.cos(angle)*hip,this.posX=this.pole.posX+ca,this.posY=this.pole.posY-co,this.posX-=this.sizeX/2,this.posY-=this.sizeY/2},castFromPole:function(){this.castedAngle=this.pole.rotation,normalizedAngle=Math.abs(this.castedAngle<-90?180+this.castedAngle:this.castedAngle),this.radiusIncrement=15/(90/normalizedAngle),console.log("angle: "+this.castedAngle),console.log("radius: "+this.radiusIncrement),this.flyingRadius=this.pole.scaledSizeX(),this.attached=!1,this.flying=!0}}).init(function(){this.on({update:this.update})}).dispose(function(){}),re.e("level level1.tmx").attr({version:1,orientation:"orthogonal",width:64,height:25,tilewidth:16,tileheight:16,tileset:[{firstgid:1,name:"area01_level_tiles",tilewidth:16,tileheight:16,image:{source:"../../../../../Downloads/gfxlib-fuzed/Backgrounds/lev01_checkers/area01_tileset/area01_level_tiles.png",trans:"ff00ff",width:320,height:200}},{firstgid:241,name:"sewer_tileset",tilewidth:16,tileheight:16,image:{source:"../../../../../Downloads/sewer_tileset.png",trans:"ff00ff",width:192,height:217}}],layer:[{name:"Camada de Tiles 1",width:64,height:25,data:{$:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}},{name:"mapa",width:64,height:25,data:{$:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[4,42,43,42,43,42,43,42,43,42,43,42,43,42,43,5,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306],[24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306,306]]}}]}),re.load.path="assets/",re.assets={images:["images/airBubble1.png","images/background.png","images/bearPurple.png","images/bearYellow.png","images/bird.png","images/cliff.png","images/cloud1.png","images/cloud2.png","images/cloud3.png","images/fishingRod1.png","images/fishLarge1.png","images/fishLarge2.png","images/fishLarge3.png","images/fishLarge4.png","images/fishMedium1.png","images/fishMedium2.png","images/fishMedium3.png","images/fishMedium4.png","images/fishSmall1.png","images/fishSmall2.png","images/fishSmall3.png","images/fishSmall4.png","images/fishVeryLarge1.png","images/heart1.png","images/landscape1.png","images/landscape2.png","images/landscape3.png","images/landscape4.png","images/landscape5.png","images/lureBomb.png","images/lureLarge.png","images/lureMedium.png","images/lureSmall.png","images/purchasedialog.png","images/rock1.png","images/rock2.png","images/rock3.png","images/rock4.png","images/storeContainer.png","images/watertile.png"],sounds:[]},re.canvas="#game-canvas";